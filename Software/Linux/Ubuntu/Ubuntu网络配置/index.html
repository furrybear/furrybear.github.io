<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Furrybear">
    <link rel="canonical" href="https://furrybear.readthedocs.com/Software/Linux/Ubuntu/Ubuntu网络配置/">
    <link rel="shortcut icon" href="../../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>参考 - Furrybear's Blog</title>
    <link href="../../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\u53c2\u8003", url: "#_top", children: [
          ]},
          {title: "\u67e5\u770b\u5185\u6838\u8def\u7531\u8868", url: "#_2", children: [
          ]},
          {title: "\u663e\u793a\u7f51\u5361\u201c\u8bbe\u5907\u672a\u6258\u7ba1\u201d\u89e3\u51b3\u529e\u6cd5", url: "#_3", children: [
          ]},
          {title: "\u4e3aKVM\u914d\u7f6e\u7f51\u6865", url: "#kvm", children: [
          ]},
        ];

    </script>
    <script src="../../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../../SSH/OpenSSH：免密登录/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../../SSH/OpenSSH：免密登录/" class="btn btn-xs btn-link">
        原理
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../Profile,_Bashrc_And_Zshrc/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../Profile,_Bashrc_And_Zshrc/" class="btn btn-xs btn-link">
        Profile, Bashrc And Zshrc
      </a>
    </div>
    
  </div>

    

    <h1 id="_1">参考</h1>
<ul>
<li><a href="https://blog.csdn.net/FIELDOFFIER/article/details/48497833">Ubuntu14.04+KVM配置虚拟机桥接（bridge）</a></li>
</ul>
<h1 id="_2">查看内核路由表</h1>
<pre><code class="sh"># 内核 IP 路由表
route -n
</code></pre>

<p>会打印出如下表格：</p>
<pre><code>内核 IP 路由表
目标            网关            子网掩码        标志  跃点   引用  使用 接口
0.0.0.0         192.168.1.253   0.0.0.0         UG    0      0        0 br0
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 br0
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br0
192.168.122.0   0.0.0.0         255.255.255.0   U     0      0        0 virbr0
</code></pre>

<h1 id="_3">显示网卡“设备未托管”解决办法</h1>
<pre><code class="sh">sudo touch /etc/NetworkManager/conf.d/10-globally-managed-devices.conf
</code></pre>

<h1 id="kvm">为KVM配置网桥</h1>
<p>为了充分利用服务器资源，避免各个用户互相污染全局环境，所以需要用KVM虚拟机给小白用户们隔离环境。在这之前需要对宿主机的网络进行配置，使得KVM虚拟机们能够通外网。</p>
<p><img alt="" src="https://img-blog.csdn.net/20150916170617267" /></p>
<p>这张图有助于理解Linux下的虚拟网桥是什么，但是还是不大清晰。我目前的理解是，新建的虚拟网桥br0是以物理网卡eno1为基础的。而宿主机以br0作为网络出口的，宿主机有自己的网络配置。其他虚拟机也可以连接到br0，虚拟机也有自己的网络配置。宿主机和虚拟机在配置网桥后都在原来宿主机所在的局域网内。</p>
<p>接下来讲做法，我的环境是在Ubuntu 16.04，物理网卡是eno1，创建的网卡是br0：</p>
<p>首先创建一个网桥（brctl命令需要<code>apt-get install bridge-utils</code>）：</p>
<pre><code class="sh">brctl addbr br0
</code></pre>

<pre><code class="sh"># 查看网卡名
ls /proc/sys/net/ipv4/conf
</code></pre>

<p>然后，修改网络配置文件/etc/network/interfaces为：</p>
<pre><code>auto lo
iface lo inet loopback

auto eno1
iface eno1 inet manual
iface eno1 inet6 manual

auto br0
iface br0 inet static
address 10.21.4.41
network 10.21.0.0
netmask 255.255.0.0
gateway 10.21.0.254
broadcast 10.21.255.255
dns-nameserver 159.226.8.6
bridge_ports eno1
bridge_stp off
bridge_fd 0
bridge_maxwait 0
iface br0 inet6 auto
</code></pre>

<p>然后，重启网络：</p>
<pre><code class="sh">/etc/init.d/networking restart
</code></pre>

<p>我这里遇到一个问题：重启失败。查找资料后，用以下命令后就能重启成功了：</p>
<pre><code class="sh">ip addr flush dev br0
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../../SSH/OpenSSH：免密登录/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../../SSH/OpenSSH：免密登录/" class="btn btn-xs btn-link">
        原理
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../Profile,_Bashrc_And_Zshrc/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../Profile,_Bashrc_And_Zshrc/" class="btn btn-xs btn-link">
        Profile, Bashrc And Zshrc
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/furrybear/furrybear.github.io/edit/src/notes/Software/Linux/Ubuntu/Ubuntu网络配置.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>