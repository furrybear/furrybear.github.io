<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Furrybear">
    <link rel="canonical" href="https://furrybear.readthedocs.com/Software/Linux/Linux_VFS/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Linux VFS - Furrybear's Blog</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\u6587\u4ef6\u6743\u9650\u548c\u6587\u4ef6\u7c7b\u578b", url: "#_top", children: [
              {title: "\u67e5\u770b\u6587\u4ef6\u6743\u9650", url: "#_2" },
              {title: "Linux\u4e0b\u6587\u4ef6\u7c7b\u578b", url: "#linux" },
              {title: "\u76ee\u5f55\u6587\u4ef6\u6743\u9650\u5206\u6790", url: "#_3" },
          ]},
          {title: "\u4fee\u6539\u6587\u4ef6\u6743\u9650", url: "#_4", children: [
              {title: "\u5176\u4ed6", url: "#_5" },
          ]},
          {title: "inode", url: "#inode", children: [
          ]},
          {title: "\u786c\u94fe\u63a5\u4e0e\u8f6f\u94fe\u63a5", url: "#_6", children: [
              {title: "\u786c\u94fe\u63a5", url: "#_7" },
              {title: "\u8f6f\u94fe\u63a5", url: "#_8" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Linux_sudo_Command/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Linux_sudo_Command/" class="btn btn-xs btn-link">
        Linux sudo Command
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Linux_Users_And_Groups/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Linux_Users_And_Groups/" class="btn btn-xs btn-link">
        Linux下用户权限和用户组
      </a>
    </div>
    
  </div>

    

    <p>参考：<a href="https://www.jb51.net/LINUXjishu/542222.html">https://www.jb51.net/LINUXjishu/542222.html</a></p>
<p>参考：<a href="https://blog.csdn.net/ty_laurel/article/details/51407107">https://blog.csdn.net/ty_laurel/article/details/51407107</a></p>
<h1 id="_1">文件权限和文件类型</h1>
<h2 id="_2">查看文件权限</h2>
<p><code>ls -lhs</code>命令输出例如“-rwxrw-r-- 1 root root 1213 Feb 2 09:39 &lt;文件名或者目录名&gt;”。</p>
<p>第一列的“-rwxrw-r--”，第一个字符代表文件类型，其余字符每3个一组（rwx），读（r）、写（w）、执行（x）。第一组rwx表示文件所有者的权限是读、写和执行。第二组rw-表示与文件所在组同组的用户只能读写但不能执行。第三组r--表示其他用户的只能读，不能写和执行。</p>
<p>第二列的1表示连接的文件数。</p>
<p>第三列的root表示文件所有者。</p>
<p>第四列的root表示文件所在组。</p>
<p>第四列的1213表示文件大小（字节）。</p>
<p>第五列的“Feb 2 09:39”表示最后修改日期。</p>
<p><strong>注</strong>：</p>
<p>（1）对于普通文件，权限一般是“-rw-rw-r--”；对于目录，权限一般是“drwxr-xr-x”。
（2）对于目录来说，当前用户只有对它和它往上所有父目录有执行权限x才能进入目录。
（3）对于创建一个文件或者目录，要求对直接父目录有写权限w和执行权限x，对再往上的父目录有执行权限x。
（4）对于删除一个文件或者目录，要求对直接父目录有写权限w和执行权限x，对再往上的父目录有执行权限x。</p>
<h2 id="linux">Linux下文件类型</h2>
<ol>
<li>
<p>（-）普通文件（硬链接是普通文件）</p>
</li>
<li>
<p>（d）目录文件，记录文件名和inode的对应关系。</p>
</li>
<li>
<p>（l）软链接/符号链接文件</p>
</li>
<li>
<p>（b）块文件，设备文件的一种</p>
</li>
<li>
<p>（c）字符文件，设备文件的一种</p>
</li>
</ol>
<h2 id="_3">目录文件权限分析</h2>
<p>目录文件其实就是个map，所以它的r和读取文件名有关、w和增删条目有关，x和获取inode号有关：</p>
<p>r-x：可以进入cd该目录，可以获得该目录下存储情况，但是不能修改这个目录内部存储的文件（目录）的名字，也不能在该目录下新建文件和目录</p>
<p>-wx：可以进入cd该目录，但是看不到该目录下的存储情况（ls不可用），可以往该目录下添加、修改、删除文件。可以通过cat来读取该目录下的文件or目录的内容，由于得不到该目录下存储了那些文件，在不知情的情况下只能通过猜，cat + 文件名获得文件内容，所以这样依然不保密。</p>
<p>--x：可以进入cd该目录，看不到存储情况，也不能往该目录下添加、修改、删除文件。但是依然可以通过cat + xx（猜）来获得该目录下的文件的内容。</p>
<p>rw-：不能进入cd该目录，用ls仅仅可以获得文件名和目录名，因为获取不到这些文件的inode号，当然也不能获得该目录下的文件的内容。不能往该目录下添加、修改、删除文件。</p>
<h1 id="_4">修改文件权限</h1>
<pre><code class="sh">//赋予abc权限rwxr-xr-x
chmod 755 abc
//同上u=用户权限，g=组权限，o=其他用户权限
chmod u=rwx，g=rx，o=rx abc
//给abc去除用户执行的权限，增加组写的权限
chmod u-x，g+w abc
//给所有用户添加读的权限
chmod a+r abc
//改变abc的所有者为xiaoming（参数-R表示改变所有子目录子文件所有者）
chown xiaoming abc
//改变abc所属的组为root（参数-R表示改变所有子目录子文件所属组）
chgrp root abc
</code></pre>

<h2 id="_5">其他</h2>
<p>（这句话有疑问，还需要对<code>usermod -a -G &lt;其他组名&gt; www-data</code>进行实验）对于apache2这种程序，它在访问文件或者目录时有执行用户和执行用户组的概念（一般为www-data和www-data）。如果执行用户组和文件或者目录的所属组相同，那么文件或者目录的所属组权限生效；如果执行用户和文件或者目录的所有者相同，那么文件或者目录的所有者权限生效。</p>
<h1 id="inode">inode</h1>
<pre><code class="c">struct inode {
    struct hlist_node   i_hash;     /* hash链表的指针 */
    struct list_head    i_list;     /* backing dev IO list */
    struct list_head    i_sb_list;  /* 超级块的inode链表 */
    struct list_head    i_dentry;   /* 引用inode的目录项对象链表头 */
    unsigned long       i_ino;      /* 索引节点号 */
    atomic_t            i_count;    /* 引用计数器 */
    unsigned int        i_nlink;    /* 硬链接数目 */
    ...
</code></pre>

<h1 id="_6">硬链接与软链接</h1>
<h2 id="_7">硬链接</h2>
<p>目录存储的是文件名和inode号的映射。</p>
<p>所以硬链接其实就是多个文件名指向同个inode，inode会记录有多少文件名指向它（i_nlink）。</p>
<p>另外不能跨文件系统进行硬链接的创建；不能对目录进行硬链接的创建。</p>
<h2 id="_8">软链接</h2>
<p><img alt="" src="../linux_soft_link.jpg" /></p>
<p>可以指向不存在的文件或者目录。</p>
<p>使用<code>ln -s &lt;源路径&gt; &lt;目标路径&gt;</code>创建软链接注意要都使用绝对路径。
　　</p>

  <br>
    

    
    
      
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Linux_sudo_Command/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Linux_sudo_Command/" class="btn btn-xs btn-link">
        Linux sudo Command
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Linux_Users_And_Groups/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Linux_Users_And_Groups/" class="btn btn-xs btn-link">
        Linux下用户权限和用户组
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/furrybear/furrybear.github.io/edit/src/notes/Software/Linux/Linux_VFS.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>