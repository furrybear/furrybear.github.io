<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Furrybear">
    <link rel="canonical" href="https://furrybear.readthedocs.com/2. Programming in Python/Python3项目打包和分发/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Python3项目打包和分发 - Furrybear's Blog</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Python3\u9879\u76ee\u6253\u5305\u548c\u5206\u53d1", url: "#_top", children: [
              {title: "\u76f8\u5173\u94fe\u63a5", url: "#_1" },
              {title: "\u5e38\u89c1\u9879\u76ee\u7ed3\u6784", url: "#_2" },
              {title: "\u6253\u5305\u5206\u53d1", url: "#_3" },
              {title: "\u975e\u4ee3\u7801\u6587\u4ef6\u6253\u5305", url: "#_4" },
              {title: "setup.py\u4f8b\u5b50", url: "#setuppy" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Windows下Python3常见坑/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Windows下Python3常见坑/" class="btn btn-xs btn-link">
        Windows下Python3常见坑
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Python3调试方法/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Python3调试方法/" class="btn btn-xs btn-link">
        Python3调试方法学习笔记
      </a>
    </div>
    
  </div>

    

    <h1 id="python3">Python3项目打包和分发</h1>
<h2 id="_1">相关链接</h2>
<ul>
<li><a href="https://packaging.python.org/">Python Packaging User Guide</a></li>
</ul>
<h2 id="_2">常见项目结构</h2>
<p>Python3项目一般打包作为一个Python3包（Package）安装在别人在计算机上。具体项目结构和setup.py文件编写见<a href="https://packaging.python.org/tutorials/packaging-projects/">Packaging Python Projects</a>。</p>
<h2 id="_3">打包分发</h2>
<p>为了分发Python3包，需要将项目打包为一个文件，一般使用<code>./setup.py bdist_wheel</code>将项目打包为wheel格式文件。在其他机器上使用<code>pip3 install &lt;文件名&gt;.whl</code>安装Python3包。</p>
<p>如果分发时不需要将文件打包为一个wheel文件，可以在项目目录下执行<code>pip3 install .</code>即可以安装项目；执行<code>pip3 install -e .</code>为调试模式，（让人疑惑的是，调试模式下无法删除scripts文件，即无法干净卸载）。项目托管在git仓库上时，可以之间用<code>pip3 install git+ssh://&lt;主机名&gt;/&lt;用户名&gt;/&lt;仓库名&gt;</code>或者<code>pip3 install git+https://&lt;主机名&gt;/&lt;用户名&gt;/&lt;仓库名&gt;</code>安装。</p>
<h2 id="_4">非代码文件打包</h2>
<p>一般打包时只打包py文件。非py文件打包分两种，一种是打包进包中，另一种是其他位置。</p>
<ol>
<li>打包进包中</li>
</ol>
<p>一种方法是在包中放置MANIFEST.in，具体方法见<a href="https://python-packaging.readthedocs.io/en/latest/non-code-files.html">Adding Non-Code Files</a>。</p>
<p>另一种方法是在setup.py中增加<code>package_data</code>字段。我没有实践过，具体方法见<a href="https://packaging.python.org/guides/distributing-packages-using-setuptools/#package-data">Packaging and distributing projects</a></p>
<ol>
<li>安装时放到其他位置
　　在setup.py中增加<code>data</code>字段。具体方法见<a href="https://packaging.python.org/guides/distributing-packages-using-setuptools/#data_files">Packaging and distributing projects</a>。例如：</li>
</ol>
<pre><code class="python">//...
data_files=[('config', ['config/hehe.yml'])],　　
//...
</code></pre>

<p>普通用户权限下安装一般会放到<code>$HOME/.local/config/hehe.yml</code>（前缀取决于site.USER_BASE变量），root权限下安装一般会放到<code>/usr/local/config/hehe.yml</code>（前缀取决于sys.prefix变量）。</p>
<h2 id="setuppy">setup.py例子</h2>
<pre><code class="python3">#!/usr/bin/env python3
import os
from setuptools import setup

with open('requirements.txt') as f:
    requirements = f.read().splitlines()

with open('README.md') as f:
    readme_content = f.read()


setup(
    name=&quot;img_mgr&quot;,
    version=&quot;0.0.1&quot;,
    author=&quot;Furrybear&quot;,
    author_email=&quot;fbcll@outlook.com&quot;,
    description=(&quot;Miaomiao.&quot;),
    license=&quot;GPLv2&quot;,
    keywords=&quot;image manager&quot;,
    url=&quot;&quot;,
    packages=['img_mgr'],
    long_description=readme_content,
    scripts=[
        'scripts/bear-img-export',
        'scripts/bear-img-repair'
    ],
    install_requires=requirements
)
</code></pre>

  <br>
    

    
    
      
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Windows下Python3常见坑/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Windows下Python3常见坑/" class="btn btn-xs btn-link">
        Windows下Python3常见坑
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Python3调试方法/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Python3调试方法/" class="btn btn-xs btn-link">
        Python3调试方法学习笔记
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/furrybear/furrybear.github.io/edit/src/notes/2. Programming in Python/Python3项目打包和分发.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>